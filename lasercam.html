<html>
<head>
<title>Laser Cam Control</title>
</head>
<body>
    <table border=1>
        <tr><td align=center colspan=2><img id="video" width=640 height=480/></td></tr>

        <tr><td bgcolor=#ffffaa align=center>CAMERA CONTROL</td><td bgcolor=#aaffff align=center>LASER CONTROL</td></tr>
        <tr>
            <td align=center>
                <button type="button" onclick=ws_send_msg("CU")>UP</button>
                <button type="button" onclick=ws_send_msg("CD")>DOWN</button>
                <button type="button" onclick=ws_send_msg("CL")>LEFT</button>
                <button type="button" onclick=ws_send_msg("CR")>RIGHT</button><br/>
                <button type="button" onclick=ws_send_msg("CN")>START STREAM</button>
                <button type="button" onclick=ws_send_msg("CO")>STOP STREAM</button>                
            </td>
            <td align=center>
                <button type="button" onclick=ws_send_msg("LU")>UP</button>
                <button type="button" onclick=ws_send_msg("LD")>DOWN</button>
                <button type="button" onclick=ws_send_msg("LL")>LEFT</button>
                <button type="button" onclick=ws_send_msg("LR")>RIGHT</button><br/>
                <button type="button" onclick=ws_send_msg("LN")>LASER ON</button>
                <button type="button" onclick=ws_send_msg("LO")>LASER OFF</button>                
            </td>
        </tr>
        <tr><td align=center colspan=2>
            <button type="button" onclick=ws_send_msg("SN")>SERVOS ON</button>
            <button type="button" onclick=ws_send_msg("SO")>SERVOS OFF</button>
        </td></tr>        
    </table>

<script>
    // call back when browser window is closed
    window.onclose = ws_close;
    
    // instatiate and open websocket
    var ws = new WebSocket("ws://"+location.host+"/ws");
    
    // send message
    function ws_send_msg(msg) {
        if (ws.readyState == WebSocket.OPEN) {
            ws.send(msg)
        }
    }
    
    // close the socket 
    function ws_close() {
        if (ws.readyState == WebSocket.OPEN) {
            ws.close()
        }
    }
    
    // handler for receiving messages
    ws.onmessage = function (messageEvent) {
        video.src = "data:image/jpeg;base64," + messageEvent.data;
    }
</script>
</body>
</html>